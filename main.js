(()=>{"use strict";var e=document.querySelector(".cards__list"),t=document.querySelector("#card-name"),n=document.querySelector("#card-link"),o=document.querySelector(".popup_theme_img"),c=document.querySelector(".profile__add-button"),r=document.querySelector(".popup_theme_card"),a=r.querySelector(".popup__form");function u(e){var t=document.querySelector("#card-template").content.querySelector(".cards__body").cloneNode(!0),n=t.querySelector(".cards__img"),c=t.querySelector(".cards__like-counter"),r=t.querySelector(".cards__like-button"),a=t.querySelector(".cards__remove-button");return c.textContent=e.likes.length,t.querySelector(".cards__title").textContent=e.name,n.src=e.link,n.alt=e.name,e.likes.some((function(e){return e.name==v.textContent}))&&r.classList.add("cards__like-button_status_active"),r.addEventListener("click",(function(t){t.target.classList.contains("cards__like-button_status_active")?f(e._id,c):d(e._id,c),t.target.classList.toggle("cards__like-button_status_active")})),e.owner.name==v.textContent&&(a.style.display="block"),a.addEventListener("click",(function(n){l(e._id),t.remove()})),t.querySelector(".cards__img").addEventListener("click",(function(){var t,n,c,r;t=o,n=e.name,c=e.link,(r=t.querySelector(".popup__img")).src=c,r.alt=n,t.querySelector(".popup__caption").textContent=n,x(o)})),t}function s(e,t){e.prepend(t)}var i={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"d9ff5da1-b706-4c23-8de1-6bd8c391fef1","Content-Type":"application/json"}},l=function(e){fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},d=function(e,t){fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))},f=function(e,t){fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t.textContent=e.likes.length})).catch((function(e){console.log(e)}))};function p(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function _(e,t){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup"))&&P(t)}var m=document.querySelector(".popup_theme_main"),h=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__subtitle"),S=document.querySelector(".profile__avatar"),b=document.querySelector("#author-name"),k=document.querySelector("#profession"),q=m.querySelector(".popup__form"),L=document.querySelector(".popup_theme_avatar"),E=document.querySelector(".profile__avatar-button"),g=L.querySelector(".popup__form"),C=document.querySelector("#avatar-link"),j=function(e,t){t.querySelector(".popup__submit-button").textContent=e?"Сохранение...":"Сохранить"};function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",p)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",p)}var U=function(e,t){t.value=e.textContent},T=function(e,t,n,o){e.textContent=o.name,t.textContent=o.about,n.src=o.avatar},A=function(e){e.querySelector(".popup__submit-button").classList.add("popup__submit-button_disabled")},B=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)};h.addEventListener("click",(function(){U(v,b),U(y,k),x(m)})),E.addEventListener("click",(function(){x(L)})),L.addEventListener("click",(function(e){_(e,L)})),g.addEventListener("submit",(function(e){j(!0,L),fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:C.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){S.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){j(!1,L)})),P(L),A(g)})),m.addEventListener("click",(function(e){_(e,m)})),q.addEventListener("submit",(function(e){e.preventDefault(),j(!0,m),fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:b.value,about:k.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){T(v,y,S,e)})).catch((function(e){console.log(e)})).finally((function(){j(!1,m)})),P(m)})),c.addEventListener("click",(function(){x(r)})),r.addEventListener("click",(function(e){_(e,r)})),a.addEventListener("submit",(function(o){o.preventDefault(),j(!0,r),fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t.value,link:n.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){s(e,u(t))})).catch((function(e){console.log(e)})).finally((function(){j(!1,r)})),a.reset(),P(r),A(a)})),o.addEventListener("click",(function(e){_(e,o)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o){var c=Array.from(e.querySelectorAll(t)),r=e.querySelector(n);B(c,r,o),c.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,t,o),B(c,r,o)}))}))}(t,e.inputSelector,e.submitButtonSelector,e)}))}({formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__field_type_error",errorClass:"popup__field-error_active"}),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка!!!: ".concat(e.status))})).then((function(t){t.forEach((function(t){s(e,u(t))}))})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){T(v,y,S,e)})).catch((function(e){console.log(e)}))})();